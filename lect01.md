Виртуальные машины. Лекция 1

Управление ресурсами.

Аналогия - кастрюля с супом и куча голодных студентов, которых надо накормить. Возникает вопрос, как?
  * Хороший вопрос - ограничен ли объем ресурса?
  * Есть ли приоритеты?
  * Какова окончательная цель(удовлетворить абсолютно всех или что-то еще)?
  * Варианты:
    - Каждый подходит к кастрюле по желанию и ест
    - Все стоят в очереди и едят сколько хотят(или фиксированный квант времени)
    - А если у всех разные потребности?
      - Каждый честно называет свои потребности
      - Каждый хочет как можно больше

Мораль: при дизайне менеджера ресурсов нужно ответить на все вышеперечисленные вопросы. В реальных вещах есть некоторый элемент черной магии(теория расписаний, задача составления расписания за быстро нерешается), то есть люди пишут некоторый набор эвристик.

Рабочий набор(Working Set) -- набор страниц памяти, необходимый для работы приложения.

Любой менеджер виртуальной памяти сам определяет рабочий набор приложений и старается поддерживать мир в таком состоянии, когда рабочие наборы приложений находятся в физической памяти(не в свопе, ни еще где-либо)

Важнейший ресурс - память, очевидно. Даже в языке С с его ручным управлением памятью можно явно выделять и освобождать, можно неявно(сам стек для процесса).

ОС делает примерно следующее: она видит исключительную ситуацию, что процесс пытается прочитать недалеко от стек поинтера; она думает, что это наверное выделение нового стека, подкладывает физическую страницу, маппит ее и выделяет память. Если она видит, что страница больше не используется, то она дампит ее содержимое на диск, помечает страницу как недоступную и переиспользует

В разных языках, у разных операторов выделения объектов разные контракты(у new в Java, у nmap(наверное вообще самый сложный системный вызов) и так далее)

О виртуальной машине можно мыслить, как об универсальном менеджере ресурсов(Everything is a resource)

Разные виды ресурсов(память, процессорное время, сеть, оконный интерфейс). Менеджер ресурсов не может создавать ресурсов из ничего

API для управления памятью - malloc, free ...
-\\- для процессорного времени - nice, renice, yield ...

Контекст - некоторый набор ожиданий, что хочется увидеть на машине, где будет исполнятся код(типа glibc). Соответственно, хороший вопрос, какой контекст мы хотим предоставлять тому, кто хочет исполняться на нашей машине
